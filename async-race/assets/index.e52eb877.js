const H=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};H();function g(a,e=document){const t=e.querySelector(a);if(!t)throw new Error(`Selector '${a}' didn't match any elements.`);return t}function c({tagName:a,classes:e,attributes:t,text:n}){const s=document.createElement(a);return e&&(typeof e=="string"?s.classList.add(e):s.classList.add(...e)),t&&Object.entries(t).forEach(([r,o])=>{s.setAttribute(r,o)}),n&&(s.innerText=n),s}function G({type:a,page:e,carsCount:t,carsPerPage:n,handleClick:s}){const r=c({tagName:"div",classes:"pagination"}),o=Math.ceil(t/n),d=["Prev","Next"].map(i=>{const l=c({tagName:"button",classes:["btn",`pagination__${i}`],text:i});return i==="Prev"&&(l.addEventListener("click",()=>{s(a,"Prev")}),e===1?l.setAttribute("disabled","true"):l.removeAttribute("disabled")),i==="Next"&&(l.addEventListener("click",()=>{s(a,"Next")}),e===o?l.setAttribute("disabled","true"):l.removeAttribute("disabled")),l});return r.append(...d),r}function S(a){return a[Math.floor(Math.random()*(a.length+1))]}function I(){const a="0123456789ABCDEF";let e="#";for(let t=0;t<6;t+=1)e+=a[Math.floor(Math.random()*16)];return e}async function O({carId:a,carImage:e,time:t,totalDistance:n,driveCarCallback:s}){const r=performance.now();let o=null;return requestAnimationFrame(function i(l){const u=(l-r)/t,h=n*u;e.style.transform=`translateX(${Math.min(h,n)}px)`,u<1&&o===null&&requestAnimationFrame(i)}),await s(a).then(i=>(o=i,i))?Promise.resolve({carId:a,time:t}):Promise.reject(new Error(`Car #${a} has been stopped suddenly. It's engine was broken down.`))}const M="http://127.0.0.1:3000",v=`${M}/garage`,N=`${M}/winners`,P=`${M}/engine`,x=7,X=10;async function E({page:a=1,limit:e=x}={}){const t=`${v}?_page=${a}&_limit=${e}`,n=await fetch(t),s=await n.json(),r=+(n.headers.get("X-Total-Count")??0);return{items:s,page:a,count:r}}const j=async a=>(await fetch(`${v}/${a}`)).json(),F=async(a,e="#000000")=>{const t=new Headers;t.append("Content-Type","application/json");const n=JSON.stringify({name:a,color:e});return(await fetch(v,{method:"POST",headers:t,body:n})).status},U=async(a,e="#000000")=>{const t=new Headers;t.append("Content-Type","application/json");const n=JSON.stringify({name:a,color:e});return fetch(v,{method:"POST",headers:t,body:n})},V=async(a,e,t="#000000")=>{const n=new Headers;n.append("Content-Type","application/json");const s=JSON.stringify({name:e,color:t}),r={method:"PUT",headers:n,body:s};return(await fetch(`${v}/${a}`,r)).status},J=async a=>{const e=new Headers;e.append("Content-Type","application/json");const t={method:"DELETE",headers:e};return(await fetch(`${v}/${a}`,t)).status},K=async a=>{const e=new Headers;e.append("Content-Type","application/json");const t={method:"DELETE",headers:e};return(await fetch(`${N}/${a}`,t)).status};function Y(a,e){return a&&e?`&_sort=${a}&_order=${e}`:""}async function y({page:a=1,limit:e=X,sort:t="time",order:n="ASC"}={}){const s=`${N}?_page=${a}&_limit=${e}${Y(t,n)}`,r=await fetch(s),o=await r.json(),d=await Promise.all(o.map(async l=>({...l,...await j(l.id)}))),i=+(r.headers.get("X-Total-Count")??0);return{items:d,page:a,count:i}}const Q=async a=>(await fetch(`${N}/${a}`)).json();async function A(a,e){const t={method:"PATCH"},n=`${P}?id=${a}&status=${e}`;return(await fetch(n,t)).json()}const Z=async({id:a,time:e,wins:t})=>{const n=new Headers;n.append("Content-Type","application/json");const s=JSON.stringify({id:a,time:e,wins:t});return(await fetch(N,{method:"POST",headers:n,body:s})).status},ee=async({id:a,time:e,wins:t})=>{const n=new Headers;n.append("Content-Type","application/json");const s=JSON.stringify({time:e,wins:t}),r={method:"PUT",headers:n,body:s};return(await fetch(`${N}/${a}`,r)).status};async function $(a){const e={method:"PATCH"},n=`${P}?id=${a}&status=drive`;return fetch(n,e).then(s=>s.json()).then(()=>!0).catch(()=>!1)}class te{model;constructor(e){this.model=e}headerButtonClickHandler(e){this.model.state={...this.model.state,currentView:e};const t=g(".main__garage"),n=g(".main__winners");[t,n].forEach(r=>{r.classList.toggle("d-none")}),this.model.notifyObservers(["Header"])}handleWinnersOrder(e){this.model.state.winners.sortOrder=this.model.state.winners.sortOrder==="ASC"?"DESC":"ASC",y({sort:e,order:this.model.state.winners.sortOrder}).then(({items:t,count:n,page:s})=>{this.model.state.winners.items=t,this.model.state.winners.count=n,this.model.state.winners.page=s,this.model.state.winners.sortBy=e,this.model.notifyObservers(["Winners"])})}handlePaginationClickButton(e,t){const n=this.model.state.currentView==="Garage"?this.model.state.cars:this.model.state.winners,s=t==="Prev"?n.page-1:n.page+1;e==="Garage"&&E({page:s}).then(({items:r,count:o})=>{n.items=r,n.count=o,n.page=s,this.model.notifyObservers([e])}),e==="Winners"&&y({page:s}).then(({items:r,count:o})=>{n.items=r,n.count=o,n.page=s,this.model.notifyObservers([e])})}handleCreateCar(e,t,n){const s=t?.trim();e==="create"&&s&&F(s,n).then(r=>{this.getCars(r,201,"error with creating Car")}),e==="update"&&this.handleUpdateCar()}handleUpdateCar(){let e="",t="";const n=g(".update-car"),s=n.getAttribute("id"),r=n.children;for(let o=0;o<r.length;o+=1){const d=r[o];d.className.includes("name")&&(e=d.value),d.className.includes("color")&&(t=d.value)}s&&e&&t&&V(+s,e,t).then(o=>{this.getCars(o,200,"error with updating Car")})}handleSelectCar(e){const n=e.target.closest(".car");if(n){const s=n.getAttribute("id"),r=n.getAttribute("carName"),o=n.getAttribute("color");if(s&&r&&o){const d=g(".update-car");d.setAttribute("id",s);const i=d.children;for(let l=0;l<i.length;l+=1){const u=i[l];u.removeAttribute("disabled"),u.className.includes("name")&&(u.value=r),u.className.includes("color")&&(u.value=o)}}}}handleRemoveCar(e){Promise.allSettled([J(e),K(e)]).then(t=>{t[0].status==="fulfilled"&&this.getCars(t[0].value,200,"error with deleting Car")})}getCars(e,t,n){if(e!==t)throw new Error(n);Promise.all([E(),y()]).then(([s,r])=>{this.model.state.cars=s,this.model.state.winners.items=r.items,this.model.state.winners.page=r.page,this.model.state.winners.count=r.count,this.model.notifyObservers(["Garage","Winners"])})}generateCars(e,t){const n=()=>`${S(e)} ${S(t)}`,r=Array(100).fill(1).map(()=>U(n(),I()));Promise.all(r).then(()=>{E().then(o=>{this.model.state.cars=o,this.model.notifyObservers(["Garage"])})}).catch(o=>{console.log(o)})}handleStartCar(e,t,n,s){t.setAttribute("disabled","true"),n.removeAttribute("disabled"),A(s,"started").then(({velocity:r,distance:o})=>{const d=o/r,i=g(".car__flag"),l=e.getBoundingClientRect().left,h=i.getBoundingClientRect().right-l;O({carId:s,carImage:e,time:d,totalDistance:h,driveCarCallback:$})})}handleStopCar(e,t,n,s){A(s,"stopped").then(()=>{e.style.transform="translateX(0)",t.removeAttribute("disabled"),n.setAttribute("disabled","true")})}async handleRace(e){e.setAttribute("disabled","true");const n=this.model.state.cars.items.map(m=>m.id).map(async m=>{const w=document.getElementById(String(m));if(!w)throw new Error(`Car ${m} not found`);const C=g(".car__image",w),_=g(".car__flag"),k=C.getBoundingClientRect().left,z=_.getBoundingClientRect().right-k,{velocity:D,distance:q}=await A(m,"started"),W=q/D;return{carId:m,carImage:C,carTime:W,trackDistance:z}}),r=(await Promise.all(n)).map(({carId:m,carImage:w,carTime:C,trackDistance:_})=>O({carId:m,carImage:w,time:C,totalDistance:_,driveCarCallback:$})),o=await Promise.any(r);g(".reset-button").removeAttribute("disabled");const i=g(".modal");i.style.display="block";const l=(o.time/1e3).toFixed(2),u=`Car #${o.carId} is won with best time = ${l}s`;i.textContent=u,setTimeout(()=>{i.style.display="none"},1e4);const h=await Q(o.carId);if(!Object.keys(h).length)await Z({id:o.carId,time:Number(l),wins:1});else{const m=+(o.time/1e3).toFixed(2),w=h.time>=m?m:h.time,C=h.wins+1;await ee({id:o.carId,time:w,wins:C})}document.querySelectorAll(".car__start").forEach(m=>{m.setAttribute("disabled","true")}),document.querySelectorAll(".car__stop").forEach(m=>{m.removeAttribute("disabled")});const f=await y();this.model.state.winners.items=f.items,this.model.state.winners.count=f.count,this.model.notifyObservers(["Winners"])}handleResetCars(e){e.setAttribute("disabled","true");const t=g(".modal");t.style.display="none",this.model.state.cars.items.forEach(({id:n})=>{A(n,"stopped").then(()=>{document.querySelectorAll(".car__image").forEach(i=>{i.style.transform="translateX(0)"}),document.querySelectorAll(".car__start").forEach(i=>{i.removeAttribute("disabled")}),document.querySelectorAll(".car__stop").forEach(i=>{i.setAttribute("disabled","true")}),g(".race-button").removeAttribute("disabled")})})}}const{items:ne,page:se,count:re}=await E(),{items:ae,page:oe,count:ie}=await y(),ce={currentView:"Garage",cars:{items:ne,page:se,count:re},winners:{items:ae,page:oe,count:ie,sortBy:"time",sortOrder:"ASC"}};class le{state;observers;constructor(){this.state=ce,this.observers=[]}registerObserver(e){if(this.observers.includes(e))throw new Error("Observer already exist!");this.observers.push(e)}notifyObservers(e){if(!this.observers.length)throw new Error("The Model has no Observers to notify!");this.observers.forEach(t=>{t.update(e)})}}const de=["Garage","Winners"];class ue{controller;constructor(e){this.controller=e}update(e){if(e&&e.length&&!e.includes("All")&&!e.includes("Header"))return;const t=g("header");t.innerHTML="";const n=c({tagName:"div",classes:"wrapper"});de.forEach(s=>{n.append(this.createButton(s))}),t.append(n),document.title=`Async race - ${this.controller.model.state.currentView}`}createButton(e){const t=c({tagName:"button",classes:["btn"],text:`To ${e}`});return this.controller.model.state.currentView===e&&t.setAttribute("disabled","true"),t.addEventListener("click",()=>{this.controller.headerButtonClickHandler(e)}),t}}class he{render(){const e=g("footer"),t=c({tagName:"div",classes:"wrapper"}),n=`
    <a href="https://github.com/PavelZabalotny" class="footer__github github" target="_blank">
      <span class="github__logo"></span> <span class="github__name">Pavel Zabalotny</span>
    </a>
    <div class="footer__year">2022</div>
    <a href="https://rs.school/js/" class="footer__rs" target="_blank"></a>
    `;t.insertAdjacentHTML("beforeend",n),e.append(t)}}class me{update(e){if(e&&e.length&&!e.includes("All"))return;const t=g("main"),n=c({tagName:"div",classes:"wrapper"});t.append(n)}}const T=(a,e=64)=>`
<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg >
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="${e}" height="${e/2}" viewBox="0 0 1280.000000 640.000000"
 preserveAspectRatio="xMidYMid meet">
<g id="car-color" transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)"
fill="${a}" stroke="none">
<path d="M3525 5341 c-72 -18 -79 -28 -90 -121 -4 -30 -11 -62 -16 -71 -4 -9
-97 -51 -206 -94 -774 -304 -1348 -540 -1603 -661 -163 -77 -222 -91 -421
-104 -85 -5 -170 -14 -189 -20 -101 -32 -362 -58 -620 -63 l-115 -2 -47 -80
c-47 -78 -47 -80 -29 -100 34 -36 35 -77 5 -177 -30 -99 -34 -178 -19 -370 5
-67 4 -88 -6 -88 -29 0 -83 -56 -110 -114 -50 -106 -74 -343 -48 -467 13 -58
13 -62 3 -159 -5 -54 16 -238 28 -244 2 -1 29 -20 61 -41 73 -49 123 -103 132
-143 17 -79 167 -155 355 -181 104 -15 969 -97 1087 -104 l32 -2 5 160 c7 230
50 394 146 559 281 479 917 673 1405 429 316 -159 530 -424 598 -742 22 -106
29 -365 13 -519 l-8 -82 3002 0 c2855 0 3002 1 2995 18 -33 87 -56 325 -45
461 28 320 177 567 459 759 399 273 847 282 1243 24 239 -157 397 -392 460
-687 18 -84 15 -341 -5 -430 -8 -38 -14 -71 -12 -73 7 -8 386 20 478 34 180
28 253 65 304 152 24 41 28 57 28 127 -1 44 -9 117 -20 163 -18 79 -18 88 -2
190 31 199 40 306 41 497 1 176 -1 195 -23 260 -46 135 -103 190 -283 274
-222 104 -633 220 -1168 330 -523 108 -1524 210 -2054 211 l-229 0 -236 139
c-813 477 -1593 884 -1852 966 -498 157 -1598 195 -2892 100 l-188 -14 -47 30
c-92 58 -223 89 -297 70z m1912 -311 c13 -45 58 -305 88 -515 33 -226 74 -539
71 -542 -7 -7 -1672 40 -2054 58 -357 16 -464 56 -573 215 -62 91 -87 225 -59
326 12 40 56 74 192 148 369 198 799 289 1618 340 246 15 290 16 510 16 l194
-1 13 -45z m649 10 c383 -36 717 -86 934 -139 210 -52 451 -163 720 -332 141
-88 379 -259 380 -271 0 -5 -14 -8 -32 -8 -48 0 -114 -37 -140 -78 -24 -39
-30 -113 -15 -189 l9 -43 -904 0 -904 0 -176 540 -175 540 47 0 c25 0 141 -9
256 -20z"/>
<path d="M2617 3125 c-431 -82 -774 -440 -838 -875 -17 -117 -7 -292 24 -410
113 -436 497 -751 947 -777 507 -29 959 313 1076 813 28 117 26 348 -4 467
-94 378 -383 670 -760 768 -105 27 -336 34 -445 14z m378 -310 c84 -21 209
-85 280 -142 116 -94 210 -242 251 -393 23 -87 24 -260 0 -355 -58 -237 -242
-439 -473 -519 -531 -186 -1074 277 -969 828 30 152 94 274 206 386 111 110
237 178 385 206 84 16 235 11 320 -11z"/>
<path d="M2918 2568 c2 -90 7 -167 12 -172 17 -17 108 58 201 166 l51 57 -48
31 c-52 33 -131 65 -185 75 l-34 6 3 -163z"/>
<path d="M2591 2700 c-62 -22 -167 -82 -164 -94 3 -13 237 -216 249 -216 7 0
15 7 18 16 8 20 8 127 -1 232 -7 95 -8 96 -102 62z"/>
<path d="M3209 2355 c-57 -64 -105 -123 -107 -131 -6 -25 46 -35 157 -29 58 3
121 8 139 11 33 5 34 6 27 42 -7 44 -64 167 -92 201 l-19 24 -105 -118z"/>
<path d="M2260 2409 c-31 -44 -68 -133 -77 -186 l-6 -33 155 0 c165 0 201 9
181 44 -13 24 -204 216 -214 216 -5 0 -22 -18 -39 -41z"/>
<path d="M2786 2354 c-36 -35 0 -87 44 -64 26 14 26 56 1 70 -25 13 -27 13
-45 -6z"/>
<path d="M2751 2186 c-57 -32 -68 -111 -22 -157 43 -42 101 -43 143 -1 42 42
41 100 -1 143 -33 32 -78 38 -120 15z"/>
<path d="M2560 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20
-54 2z"/>
<path d="M3002 2124 c-27 -19 -28 -36 -3 -58 25 -23 61 -6 61 29 0 33 -30 49
-58 29z"/>
<path d="M2245 1993 c-77 -6 -76 -5 -59 -65 16 -55 61 -146 92 -186 l18 -23
103 122 c57 67 104 129 105 138 1 14 -14 16 -104 17 -58 0 -127 -1 -155 -3z"/>
<path d="M3165 1981 c-44 -4 -61 -10 -63 -22 -3 -16 210 -229 228 -229 22 0
86 141 105 228 l7 32 -109 -2 c-59 -1 -135 -4 -168 -7z"/>
<path d="M2776 1914 c-19 -18 -19 -20 -6 -45 6 -11 21 -19 35 -19 20 0 45 24
45 44 0 10 -32 36 -45 36 -7 0 -21 -7 -29 -16z"/>
<path d="M2589 1743 c-86 -90 -139 -151 -139 -162 0 -25 179 -101 236 -101
l27 0 -7 143 c-9 166 -13 187 -35 187 -9 0 -46 -30 -82 -67z"/>
<path d="M2936 1801 c-6 -10 -24 -168 -29 -258 -3 -60 -2 -63 19 -63 79 0 262
68 248 92 -5 7 -53 64 -108 126 -93 105 -117 124 -130 103z"/>
<path d="M10723 3125 c-318 -58 -597 -266 -743 -555 -223 -441 -98 -996 289
-1288 112 -84 188 -125 311 -166 274 -91 545 -70 802 61 552 282 735 983 392
1500 -225 339 -651 521 -1051 448z m385 -315 c348 -98 579 -443 532 -796 -67
-508 -596 -796 -1055 -574 -239 116 -396 352 -412 620 -20 335 192 640 516
745 122 40 289 42 419 5z"/>
<path d="M11017 2568 c3 -90 9 -167 14 -172 13 -14 53 18 155 122 l95 97 -23
18 c-50 40 -189 97 -235 97 -10 0 -11 -33 -6 -162z"/>
<path d="M10705 2706 c-50 -16 -133 -58 -163 -82 l-23 -19 121 -107 c67 -60
128 -108 135 -108 23 0 27 39 20 186 -8 162 -4 157 -90 130z"/>
<path d="M11307 2354 c-59 -65 -107 -126 -107 -136 0 -11 11 -18 38 -22 44 -7
278 7 289 17 15 16 -51 183 -94 236 l-19 24 -107 -119z"/>
<path d="M10362 2413 c-39 -62 -70 -134 -78 -184 l-7 -39 152 0 c86 0 161 5
172 10 17 10 18 13 5 38 -8 15 -59 71 -114 125 l-99 99 -31 -49z"/>
<path d="M10888 2359 c-24 -14 -23 -56 2 -69 44 -23 80 29 44 64 -18 19 -23
19 -46 5z"/>
<path d="M10851 2187 c-49 -29 -66 -101 -35 -146 9 -13 32 -29 50 -37 29 -12
39 -12 68 0 99 41 85 180 -19 192 -24 3 -50 -1 -64 -9z"/>
<path d="M10660 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20
-54 2z"/>
<path d="M11096 2124 c-9 -8 -16 -22 -16 -29 0 -13 26 -45 36 -45 20 0 44 25
44 45 0 14 -8 29 -19 35 -25 13 -27 13 -45 -6z"/>
<path d="M10335 1991 c-60 -6 -60 -6 -57 -36 9 -69 104 -248 122 -229 57 61
210 250 207 258 -4 12 -176 17 -272 7z"/>
<path d="M11267 1983 c-68 -5 -79 -19 -47 -60 23 -31 200 -193 210 -193 3 0
20 24 37 53 29 48 52 111 67 180 l6 27 -107 -2 c-60 -1 -134 -3 -166 -5z"/>
<path d="M10870 1910 c-16 -31 4 -62 38 -58 21 2 28 9 30 32 5 45 -47 65 -68
26z"/>
<path d="M10651 1703 c-56 -59 -101 -113 -101 -120 0 -28 172 -103 237 -103
l26 0 -7 123 c-10 179 -15 207 -36 207 -10 0 -63 -48 -119 -107z"/>
<path d="M11035 1801 c-7 -12 -23 -144 -29 -243 -4 -77 -4 -78 19 -78 45 0
130 22 193 51 l64 29 -19 23 c-65 82 -198 227 -209 227 -7 0 -15 -4 -19 -9z"/>
</g>
</svg>
`;class ge{element;controller;constructor(e,t){this.element=e,this.controller=t}render(){const e=c({tagName:"div",classes:"car",attributes:{id:`${this.element.id}`,color:`${this.element.color}`,carName:`${this.element.name}`}}),t=c({tagName:"div",classes:["car__image"],text:`${this.element.color}`});t.innerHTML=T(this.element.color);const n=c({tagName:"div",classes:"car__flag"}),s=c({tagName:"div",classes:"car__track"});s.append(t,n);const r=c({tagName:"div",classes:"car__change"}),o=c({tagName:"button",classes:["bnt","btn__select"],text:"Select"});o.addEventListener("click",b=>{this.controller.handleSelectCar(b)});const d=c({tagName:"button",classes:["bnt","btn__remove"],text:"Remove"});d.addEventListener("click",()=>{this.controller.handleRemoveCar(this.element.id)});const i=c({tagName:"div",classes:"car__name",text:this.element.name});r.append(o,d,i);const l=c({tagName:"div",classes:"car__race"}),u=c({tagName:"div",classes:"car__drive-buttons"}),h=c({tagName:"button",classes:["btn","car__stop"],text:"B",attributes:{disabled:"true"}}),p=c({tagName:"button",classes:["btn","car__start"],text:"A"});return p.addEventListener("click",b=>{const f=b.target;this.controller.handleStartCar(t,f,h,this.element.id)}),h.addEventListener("click",b=>{const f=b.target;this.controller.handleStopCar(t,p,f,this.element.id)}),u.append(p,h),l.append(u,s),e.append(r,l),e}}class pe{controller;constructor(e){this.controller=e}render(){const e=c({tagName:"div",classes:"main__cars"}),t=this.controller.model.state.cars.items.map(n=>new ge(n,this.controller).render());return e.append(...t),e}}class R{pageView;carCount;pageNumber;constructor(e,t,n){this.pageView=e,this.carCount=t,this.pageNumber=n}render(){const e=`${this.pageView} (${this.carCount})`,t=`Page #${this.pageNumber}`,n=c({tagName:"h2",classes:"pageTitle",text:e}),s=c({tagName:"h3",classes:"pageNumber",text:t}),r=c({tagName:"div",classes:"main__inform-titles"});return r.append(n,s),r}}class B{type;controller;constructor(e,t){this.type=e,this.controller=t}render(){const e=this.type==="Garage"?"cars":"winners",{model:{state:{[e]:{page:t,count:n}}}}=this.controller,s=this.type==="Garage"?7:10;return G({type:this.type,page:t,carsCount:n,carsPerPage:s,handleClick:this.controller.handlePaginationClickButton.bind(this.controller)})}}class L{type;controller;constructor(e,t){this.type=e,this.controller=t}render(){let e,t;const n=this.type==="create"?"create-car":"update-car",s=c({tagName:"div",classes:n}),r=c({tagName:"input",classes:`${n}__input-name`});r.addEventListener("change",i=>{t=i.target.value});const o=c({tagName:"input",classes:`${n}__input-color`,attributes:{type:"color"}});o.addEventListener("change",i=>{e=i.target.value});const d=c({tagName:"button",classes:`${n}__button`,text:this.type.toUpperCase()});return d.addEventListener("click",()=>{this.controller.handleCreateCar(this.type,t,e)}),this.type==="update"&&[r,o,d].forEach(i=>{i.setAttribute("disabled","true")}),s.append(r,o,d),s}}const be=["Acura","Alfa Romeo","Alpine","Apollo","Apple","Aston Martin","Audi","Automobili Pininfarina","Bentley","BMW","Bollinger","Brilliance","Bugatti","Buick","BYD","Cadillac","Chana","Chery","Chevrolet","Chrysler","Citroen","Continental","CUPRA","Dacia","Daewoo","Daihatsu","Datsun","Detroit Electric","Dodge","DS Automobiles","FAW","Ferrari","Fiat","Fisker","Ford","Foxtron","Geely","Genesis","GMC","Great Wall","Haval","Honda","Hummer","Hyundai","Ineos","Infiniti","Iran Khodro","JAC","Jaguar","Jeep","JETOUR","KIA","Koenigsegg","Lada","Lamborghini","Lancia","Land Rover","Lexus","Lifan","Lincoln","Lordstown","Lotus","Lucid","LvChi","Lynk & Co","Maserati","Maybach","Mazda","MCLaren","Mercedes-Benz","MG","MINI","Mitsubishi","Nikola","NIO","Nissan","Opel","Pagani","Peugeot","Polestar","Porsche","Qoros","Range Rover","Ravon","Renault","Rimac","Rivian","Rolls-Royce","Saab","Saipa","SEAT","Skoda","smart","SsangYong","SSC North America","Stellantis","Subaru","Suzuki","Tata","Tesla","Torsus","Toyota","VinFast","Volkswagen","Volvo","Xpeng","Zotye"],fe=["Durango","Ram","Challenger","Charger","Grand Caravan","X7","X5","X3","X6 M","X6","X1","X4","C3 Aircross","C5 Aircross","Duster","CR-V","Corolla","C4 Cactus","DS3 Crossback","C1","C3","Berlingo Multispace","DS4 Crossback","UX 250h","NX 300h","LC 500","RX 350/200t","Rapid","Largus","IS 200t","LS 500h","RX","ES 200/250/350","Hatchback","CX-5","Sedan","CX-30","CX-9","CX-3","MX-5 Roadster","Phantom","Camry","Polo","Cullinan","Ghost","Dawn","Duster","Arkana","Sandero","Logan","Trafic Fourgon","Logan MCV","Captur","Kadjar","RAV4","Rio","Creta","Solaris"];class we{controller;constructor(e){this.controller=e}render(){const e=c({tagName:"button",classes:["btn","generate-button"],text:"GENERATE CARS"});return e.addEventListener("click",()=>{this.controller.generateCars(be,fe)}),e}}class Ce{controller;constructor(e){this.controller=e}render(){const e=c({tagName:"button",classes:["btn","reset-button"],text:"RESET",attributes:{disabled:"true"}});return e.addEventListener("click",t=>{const n=t.target;this.controller.handleResetCars(n)}),e}}class ve{controller;constructor(e){this.controller=e}render(){const e=c({tagName:"button",classes:["btn","race-button"],text:"RACE"});return e.addEventListener("click",t=>{const n=t.target;this.controller.handleRace(n)}),e}}class _e{controller;constructor(e){this.controller=e}update(e){if(e&&e.length&&!e.includes("All")&&!e.includes("Garage"))return;const t=g(".main .wrapper"),n=t.querySelector(".main__garage");n&&n.remove();const s=c({tagName:"div",classes:"main__garage"}),r=new L("create",this.controller).render(),o=new L("update",this.controller).render(),d=new R("Garage",this.controller.model.state.cars.count,this.controller.model.state.cars.page).render(),i=new pe(this.controller).render(),l=new B("Garage",this.controller).render(),u=new ve(this.controller).render(),h=new Ce(this.controller).render(),p=new we(this.controller).render();s.append(r,o,p,u,h,d,i,l),t.append(s)}}class ye{controller;constructor(e){this.controller=e}render(){const{items:e,sortBy:t,sortOrder:n,page:s}=this.controller.model.state.winners,o=["Number","Car","Name","Wins","Best-time"].map(l=>{const u=c({tagName:"div",classes:[`winners__${l.toLowerCase()}`,"table__name"],text:l});l==="Best-time"&&u.addEventListener("click",()=>this.controller.handleWinnersOrder("time")),l==="Wins"&&u.addEventListener("click",()=>this.controller.handleWinnersOrder("wins"));const h=n==="ASC"?"&#8595;":"&#8593;";switch(t){case"wins":l==="Wins"&&(u.innerHTML=`${l} ${h}`);break;case"time":l==="Best-time"&&(u.innerHTML=`${l} ${h}`);break;default:throw new Error("Sort condition not found in switch")}return u}),d=e.map(({name:l,wins:u,time:h,color:p},b)=>{const f=c({tagName:"div",classes:["table__cell"],text:`${s*10-9+b}`}),m=c({tagName:"div",classes:["table__cell","table__car"],text:`${p}`});m.innerHTML=T(p);const w=c({tagName:"div",classes:["table__cell"],text:l}),C=c({tagName:"div",classes:["table__cell"],text:`${u}`}),_=c({tagName:"div",classes:["table__cell"],text:`${h}`});return[f,m,w,C,_]}).flat(),i=c({tagName:"div",classes:"winners__table"});return i.append(...o,...d),i}}class Ne{controller;constructor(e){this.controller=e}update(e){if(e&&e.length&&!e.includes("All")&&!e.includes("Winners"))return;const t=g(".main .wrapper"),n=t.querySelector(".main__winners");n&&n.remove();const s=this.controller.model.state.currentView==="Garage"?["main__winners","d-none"]:["main__winners"],r=c({tagName:"div",classes:s}),o=new R("Winners",this.controller.model.state.winners.count,this.controller.model.state.winners.page).render(),d=new B("Winners",this.controller).render(),i=new ye(this.controller).render();r.append(o,i,d),t.append(r)}}class Ae{render(){return c({tagName:"div",classes:"modal"})}}class Ee{controller;observers;bodyContainer;header;garagePage;winnersPage;main;footer;modal;constructor(e){this.controller=e,this.observers=[],this.bodyContainer=g("body"),this.header=new ue(e),this.garagePage=new _e(this.controller),this.winnersPage=new Ne(this.controller),this.main=new me,this.footer=new he,this.modal=new Ae().render()}init(){const t=["header","main","footer"].map(s=>c({tagName:s,classes:s}));this.bodyContainer.append(...t),this.bodyContainer.insertAdjacentElement("beforeend",this.modal),this.footer.render();const n=[this.header,this.main,this.garagePage,this.winnersPage];this.fillWithObservers(n),this.registerObservers(),this.controller.model.notifyObservers(["All"])}fillWithObservers(e){this.observers.push(...e)}registerObservers(){this.observers.forEach(e=>{this.controller.model.registerObserver(e)})}}class Me{model;controller;view;constructor(){this.model=new le,this.controller=new te(this.model),this.view=new Ee(this.controller)}init(){this.view.init()}}const Se=new Me;Se.init();
//# sourceMappingURL=index.e52eb877.js.map
